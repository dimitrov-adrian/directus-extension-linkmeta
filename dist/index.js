var e,n=(function(e){!function(e){e.exports.is_uri=t,e.exports.is_http_uri=r,e.exports.is_https_uri=i,e.exports.is_web_uri=a,e.exports.isUri=t,e.exports.isHttpUri=r,e.exports.isHttpsUri=i,e.exports.isWebUri=a;var n=function(e){return e.match(/(?:([^:\/?#]+):)?(?:\/\/([^\/?#]*))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?/)};function t(e){if(e&&!/[^a-z0-9\:\/\?\#\[\]\@\!\$\&\'\(\)\*\+\,\;\=\.\-\_\~\%]/i.test(e)&&!/%[^0-9a-f]/i.test(e)&&!/%[0-9a-f](:?[^0-9a-f]|$)/i.test(e)){var t,r,i,a,l,o="",s="";if(o=(t=n(e))[1],r=t[2],i=t[3],a=t[4],l=t[5],o&&o.length&&i.length>=0){if(r&&r.length){if(0!==i.length&&!/^\//.test(i))return}else if(/^\/\//.test(i))return;if(/^[a-z][a-z0-9\+\-\.]*$/.test(o.toLowerCase()))return s+=o+":",r&&r.length&&(s+="//"+r),s+=i,a&&a.length&&(s+="?"+a),l&&l.length&&(s+="#"+l),s}}}function r(e,r){if(t(e)){var i,a,l,o,s="",p="",u="",c="";if(s=(i=n(e))[1],p=i[2],a=i[3],l=i[4],o=i[5],s){if(r){if("https"!=s.toLowerCase())return}else if("http"!=s.toLowerCase())return;if(p)return/:(\d+)$/.test(p)&&(u=p.match(/:(\d+)$/)[0],p=p.replace(/:\d+$/,"")),c+=s+":",c+="//"+p,u&&(c+=u),c+=a,l&&l.length&&(c+="?"+l),o&&o.length&&(c+="#"+o),c}}}function i(e){return r(e,!0)}function a(e){return r(e)||i(e)}}(e)}(e={exports:{}},e.exports),e.exports),t={inject:["system"],props:{value:{type:Object,default:()=>({})},disabled:{type:Boolean,default:!1},placeholder:{type:String,default:null},service:{type:String,default:""},preview:{type:Array,default:()=>["image","title","url"]}},data:function(){return{loading:!1,localUrl:this.value?.url,hasError:!1}},watch:{value:function(e,n){!n&&e.url&&(this.localUrl=e.url.trim())}},computed:{canRefresh:function(){return this.value?.url&&this.localUrl&&this.localUrl===this.value?.url}},methods:{isUri:n.isWebUri,refresh:function(){this.value?.url&&this.processUrl(this.value.url)},processUrlByMicrolink:function(e){return this.system.axios.get(`https://api.microlink.io?url=${encodeURIComponent(e)}`,{headers:{"Content-Type":"application/json"}})},processUrlByExtension:function(e){return this.system.api.get(`/custom/directus-extension-linkpreview-endpoint?url=${encodeURIComponent(e)}`,{headers:{"Content-Type":"application/json"}})},processUrl:function(e){if(!this.isUri(e))return void(this.hasError="Invalid URL");this.loading=!0,this.hasError=!1;({microlink:this.processUrlByMicrolink}[this.$props.service]||this.processUrlByExtension)(e).then((e=>e.data)).then((e=>{if(this.loading=!1,"success"===e.status&&e.data)return e.data;throw Error(e.message)})).then((n=>{this.localUrl=e,this.$emit("input",n)})).catch((e=>{this.hasError=e.toString()}))},changeUrlHandler:function(e){const n=e.target.value.trim();this.localUrl=n,this.value&&this.value.url&&this.value.url===n||this.processUrl(n)},changeUrlHandlerFromLocal:function(){this.localUrl&&this.processUrl(this.localUrl)},inputUrlHandler:function(e){this.localUrl=e},getImageUrl:function(e){return"string"==typeof e?e:"object"==typeof e&&e.url?e.url:null}}};function r(e,n,t,r,i,a,l,o,s,p){"boolean"!=typeof l&&(s=o,o=l,l=!1);const u="function"==typeof t?t.options:t;let c;if(e&&e.render&&(u.render=e.render,u.staticRenderFns=e.staticRenderFns,u._compiled=!0,i&&(u.functional=!0)),r&&(u._scopeId=r),a?(c=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),n&&n.call(this,s(e)),e&&e._registeredComponents&&e._registeredComponents.add(a)},u._ssrRegister=c):n&&(c=l?function(e){n.call(this,p(e,this.$root.$options.shadowRoot))}:function(e){n.call(this,o(e))}),c)if(u.functional){const e=u.render;u.render=function(n,t){return c.call(t),e(n,t)}}else{const e=u.beforeCreate;u.beforeCreate=e?[].concat(e,c):[c]}return t}const i="undefined"!=typeof navigator&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());function a(e){return(e,n)=>function(e,n){const t=i?n.media||"default":e,r=o[t]||(o[t]={ids:new Set,styles:[]});if(!r.ids.has(e)){r.ids.add(e);let t=n.source;if(n.map&&(t+="\n/*# sourceURL="+n.map.sources[0]+" */",t+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(n.map))))+" */"),r.element||(r.element=document.createElement("style"),r.element.type="text/css",n.media&&r.element.setAttribute("media",n.media),void 0===l&&(l=document.head||document.getElementsByTagName("head")[0]),l.appendChild(r.element)),"styleSheet"in r.element)r.styles.push(t),r.element.styleSheet.cssText=r.styles.filter(Boolean).join("\n");else{const e=r.ids.size-1,n=document.createTextNode(t),i=r.element.childNodes;i[e]&&r.element.removeChild(i[e]),i.length?r.element.insertBefore(n,i[e]):r.element.appendChild(n)}}}(e,n)}let l;const o={};const s=t;var p=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",[t("v-input",{staticClass:"url-input",attrs:{disabled:e.disabled,value:e.localUrl,placeholder:e.placeholder},on:{input:e.inputUrlHandler,change:e.changeUrlHandler},scopedSlots:e._u([{key:"prepend",fn:function(){return[e.localUrl&&!e.isUri(e.localUrl)?t("v-icon",{attrs:{name:"error"}}):e.localUrl&&e.value&&e.value.url&&e.value.url===e.localUrl?t("v-icon",{attrs:{name:"verified"}}):t("v-icon",{attrs:{name:"link"}})]},proxy:!0},{key:"append",fn:function(){return[e.canRefresh?t("v-icon",{directives:[{name:"tooltip",rawName:"v-tooltip",value:e.$t("update"),expression:"$t('update')"}],attrs:{name:"sync"},on:{click:e.refresh}}):e.isUri(e.localUrl)?t("v-icon",{directives:[{name:"tooltip",rawName:"v-tooltip",value:e.$t("update"),expression:"$t('update')"}],attrs:{name:"done"},on:{click:e.changeUrlHandlerFromLocal}}):e._e()]},proxy:!0}])}),e._v(" "),e.hasError?t("v-notice",{attrs:{type:"warning"}},[e._v("\n    "+e._s(e.hasError)+"\n  ")]):e._e(),e._v(" "),e.preview.length>0?t("transition-expand",[e.loading?t("div",[t("v-skeleton-loader",[t("div",{staticClass:"loading-text"},[e._v(e._s(e.$t("loading")))])])],1):e.value&&"object"==typeof e.value?t("v-list",{staticClass:"preview"},e._l(e.preview,(function(n){return e.value[n]?t("v-list-item",{key:n,class:"preview-item-"+n},[["image","logo"].includes(n)&&e.value[n]?[t("img",{attrs:{src:e.getImageUrl(e.value[n]),rel:"noopener"}})]:"url"===n&&e.value[n]?[t("a",{attrs:{href:e.value[n],target:"_blank",rel:"noopener"}},[e._v("\n            "+e._s(e.value[n])+"\n          ")])]:"iframe"===n&&e.value[n]?[t("div",{staticClass:"iframe-wrapper-bound"},[t("div",{staticClass:"iframe-wrapper",domProps:{innerHTML:e._s(e.value[n])}})])]:e.value[n]?[t("code",{staticClass:"property"},[e._v(e._s(n))]),e._v(" "),e.value[n]?t("var",[e._v(e._s(e.value[n]))]):t("value-null")]:e._e()],2):e._e()})),1):e._e()],1):e._e()],1)};p._withStripped=!0;var u={id:"extension-linkpreview",name:"URL Preview",description:"Store link metadata using Open Graph, JSON+LD, oEmbed or HTML metadata",icon:"account_tree",component:r({render:p,staticRenderFns:[]},(function(e){e&&e("data-v-0b238975_0",{source:"\n.url-input[data-v-0b238975] {\n  --v-input-font-family: var(--family-monospace);\n}\n.loading-text[data-v-0b238975] {\n  padding: 1em;\n  text-align: center;\n}\n.preview[data-v-0b238975] {\n  background-color: var(--v-card-background-color);\n}\n.preview a[data-v-0b238975] {\n  color: var(--primary);\n  text-decoration: underline;\n}\n.preview-item-image img[data-v-0b238975] {\n  height: auto;\n}\n.preview .property[data-v-0b238975] {\n  font-weight: 600;\n  margin-inline-end: .4em;\n}\n.preview .property[data-v-0b238975]:after {\n  content: ':'\n}\n.preview-item-image img[data-v-0b238975],\n.preview-item-iframe .iframe-wrapper-bound[data-v-0b238975] {\n  width: 360px;\n  max-width: 100%;\n}\n.preview-item-iframe .iframe-wrapper-bound .iframe-wrapper[data-v-0b238975] {\n  position: relative;\n  padding-bottom: 56.25%;\n  height: 0;\n}\n.preview-item-iframe .iframe-wrapper-bound .iframe-wrapper[data-v-0b238975] iframe {\n  position: absolute !important;\n  top: 0 !important;\n  left: 0 !important;\n  width: 100% !important;\n  height: 100% !important;\n}\n",map:{version:3,sources:["/Users/e01/Workspace/directus/directus-extension-linkpreview-interface/src/interface.vue"],names:[],mappings:";AA+MA;EACA,8CAAA;AACA;AAEA;EACA,YAAA;EACA,kBAAA;AACA;AAEA;EACA,gDAAA;AACA;AAEA;EACA,qBAAA;EACA,0BAAA;AACA;AAEA;EACA,YAAA;AACA;AAEA;EACA,gBAAA;EACA,uBAAA;AACA;AAEA;EACA;AACA;AAEA;;EAEA,YAAA;EACA,eAAA;AACA;AAEA;EACA,kBAAA;EACA,sBAAA;EACA,SAAA;AACA;AAEA;EACA,6BAAA;EACA,iBAAA;EACA,kBAAA;EACA,sBAAA;EACA,uBAAA;AACA",file:"interface.vue",sourcesContent:['<template>\n  <div>\n\n    <v-input :disabled="disabled"\n             :value="localUrl"\n             :placeholder="placeholder"\n             class="url-input"\n             @input="inputUrlHandler"\n             @change="changeUrlHandler"\n    >\n      <template #prepend>\n        <v-icon name="error" v-if="localUrl && !isUri(localUrl)"/>\n        <v-icon name="verified" v-else-if="localUrl && value && value.url && value.url === localUrl"/>\n        <v-icon name="link" v-else/>\n      </template>\n      <template #append>\n        <v-icon v-if="canRefresh" name="sync" @click="refresh" v-tooltip="$t(\'update\')"/>\n        <v-icon v-else-if="isUri(localUrl)" name="done" @click="changeUrlHandlerFromLocal" v-tooltip="$t(\'update\')"/>\n      </template>\n    </v-input>\n\n    <v-notice type="warning" v-if="hasError">\n      {{ hasError }}\n    </v-notice>\n\n    <transition-expand v-if="preview.length > 0">\n      <div v-if="loading">\n        <v-skeleton-loader>\n          <div class="loading-text">{{ $t(\'loading\') }}</div>\n        </v-skeleton-loader>\n      </div>\n      <v-list v-else-if="value && typeof value === \'object\'" class="preview">\n        <v-list-item\n            v-for="previewItem in preview"\n            v-if="value[previewItem]"\n            :key="previewItem"\n            :class="\'preview-item-\' + previewItem"\n        >\n          <template v-if="[\'image\', \'logo\'].includes(previewItem) && value[previewItem]">\n            <img :src="getImageUrl(value[previewItem])" rel="noopener"/>\n          </template>\n          <template v-else-if="previewItem === \'url\' && value[previewItem]">\n            <a :href="value[previewItem]" target="_blank" rel="noopener">\n              {{ value[previewItem] }}\n            </a>\n          </template>\n          <template v-else-if="previewItem === \'iframe\' && value[previewItem]">\n            <div class="iframe-wrapper-bound">\n              <div class="iframe-wrapper" v-html="value[previewItem]"></div>\n            </div>\n          </template>\n          <template v-else-if="value[previewItem]">\n            <code class="property">{{ previewItem }}</code>\n            <var v-if="value[previewItem]">{{ value[previewItem] }}</var>\n            <value-null v-else/>\n          </template>\n        </v-list-item>\n      </v-list>\n    </transition-expand>\n\n  </div>\n</template>\n\n<script>\nimport validUrl from \'valid-url\'\n\nexport default {\n  inject: [\'system\'],\n  props: {\n    value: {\n      type: Object,\n      default: () => ({}),\n    },\n    disabled: {\n      type: Boolean,\n      default: false,\n    },\n    placeholder: {\n      type: String,\n      default: null,\n    },\n    service: {\n      type: String,\n      default: \'\',\n    },\n    preview: {\n      type: Array,\n      default: () => [\'image\', \'title\', \'url\'],\n    },\n  },\n\n  data: function () {\n    return {\n      loading: false,\n      localUrl: this.value?.url,\n      hasError: false,\n    }\n  },\n\n  watch: {\n    value: function (newVal, oldVal) {\n      if (!oldVal && newVal.url) {\n        this.localUrl = newVal.url.trim()\n      }\n    },\n  },\n\n  computed: {\n    canRefresh: function () {\n      return this.value?.url && this.localUrl && this.localUrl === this.value?.url\n    },\n  },\n\n  methods: {\n\n    isUri: validUrl.isWebUri,\n\n    refresh: function () {\n      if (this.value?.url) {\n        this.processUrl(this.value.url)\n      }\n    },\n\n    processUrlByMicrolink: function (url) {\n      return this.system.axios.get(`https://api.microlink.io?url=${encodeURIComponent(url)}`, {\n        headers: {\n          \'Content-Type\': \'application/json\',\n        },\n      })\n    },\n\n    processUrlByExtension: function (url) {\n      return this.system.api.get(`/custom/directus-extension-linkpreview-endpoint?url=${encodeURIComponent(url)}`, {\n        headers: {\n          \'Content-Type\': \'application/json\',\n        },\n      })\n    },\n\n    processUrl: function (url) {\n      if (!this.isUri(url)) {\n        this.hasError = \'Invalid URL\'\n        return\n      }\n\n      this.loading = true\n      this.hasError = false\n\n      const requester = {\n        microlink: this.processUrlByMicrolink,\n      }[this.$props.service] || this.processUrlByExtension\n\n      requester(url)\n          .then(response => response.data)\n          .then(response => {\n            this.loading = false\n            if (response.status === \'success\' && response.data) {\n              return response.data\n            }\n            else {\n              throw Error(response.message)\n            }\n          })\n          .then(data => {\n            this.localUrl = url\n            this.$emit(\'input\', data)\n          })\n          .catch((error) => {\n            this.hasError = error.toString()\n          })\n    },\n\n    changeUrlHandler: function (event) {\n      const url = event.target.value.trim()\n      this.localUrl = url\n      if (this.value && this.value.url && this.value.url === url) {\n        return\n      }\n      this.processUrl(url)\n    },\n\n    changeUrlHandlerFromLocal: function () {\n      if (this.localUrl) {\n        this.processUrl(this.localUrl)\n      }\n    },\n\n    inputUrlHandler: function (newValue) {\n      this.localUrl = newValue\n    },\n\n    getImageUrl: function (imageObject) {\n      if (typeof imageObject === \'string\') {\n        return imageObject\n      }\n      else if (typeof imageObject === \'object\' && imageObject.url) {\n        return imageObject.url\n      }\n      else {\n        return null\n      }\n    },\n  },\n}\n<\/script>\n\n<style lang="css" scoped>\n.url-input {\n  --v-input-font-family: var(--family-monospace);\n}\n\n.loading-text {\n  padding: 1em;\n  text-align: center;\n}\n\n.preview {\n  background-color: var(--v-card-background-color);\n}\n\n.preview a {\n  color: var(--primary);\n  text-decoration: underline;\n}\n\n.preview-item-image img {\n  height: auto;\n}\n\n.preview .property {\n  font-weight: 600;\n  margin-inline-end: .4em;\n}\n\n.preview .property:after {\n  content: \':\'\n}\n\n.preview-item-image img,\n.preview-item-iframe .iframe-wrapper-bound {\n  width: 360px;\n  max-width: 100%;\n}\n\n.preview-item-iframe .iframe-wrapper-bound .iframe-wrapper {\n  position: relative;\n  padding-bottom: 56.25%;\n  height: 0;\n}\n\n.preview-item-iframe .iframe-wrapper-bound .iframe-wrapper >>> iframe {\n  position: absolute !important;\n  top: 0 !important;\n  left: 0 !important;\n  width: 100% !important;\n  height: 100% !important;\n}\n</style>\n\n']},media:void 0})}),s,"data-v-0b238975",false,undefined,!1,a,void 0,void 0),types:["json"],options:[{field:"placeholder",name:"Placeholder",meta:{width:"half",interface:"text-input"}},{field:"service",name:"Scrape Service",type:"string",meta:{width:"half",interface:"dropdown",options:{choices:[{value:"",text:"LinkPreview Extension"},{value:"microlink",text:"microlink.io"}]}},schema:{default_value:""}},{field:"preview",name:"Preview",type:"csv",schema:{default_value:["image","url","title"]},meta:{width:"half",interface:"dropdown-multiselect",options:{choices:[{value:"image",text:"image"},{value:"url",text:"url"},{value:"title",text:"title"},{value:"publisher",text:"publisher"},{value:"author",text:"author"},{value:"date",text:"date"},{value:"lang",text:"lang"},{value:"logo",text:"logo"},{value:"iframe",text:"iframe"}]}}}]};export default u;
